{
  "openapi": "3.0.3",
  "info": {
    "title": "VibePocket API",
    "version": "1.0.0",
    "description": "VibePocket 后端服务 API — 收藏、历史、Persona、Suno 音乐生成、配置、音乐搜索"
  },
  "servers": [
    {
      "url": "http://localhost:8080",
      "description": "本地开发服务器"
    }
  ],
  "tags": [
    { "name": "favorites", "description": "收藏管理" },
    { "name": "history", "description": "音乐历史记录" },
    { "name": "personas", "description": "Persona 管理" },
    { "name": "suno", "description": "Suno 音乐生成（服务端代理）" },
    { "name": "config", "description": "应用配置" },
    { "name": "music", "description": "音乐搜索（网易云等）" }
  ],
  "paths": {
    "/api/favorites": {
      "get": {
        "tags": ["favorites"],
        "operationId": "getFavorites",
        "summary": "获取所有收藏",
        "responses": {
          "200": {
            "description": "收藏列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/FavoriteResponse" }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["favorites"],
        "operationId": "addFavorite",
        "summary": "添加收藏",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/FavoriteRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "新增的收藏项",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/FavoriteResponse" }
              }
            }
          }
        }
      }
    },
    "/api/favorites/{trackId}": {
      "delete": {
        "tags": ["favorites"],
        "operationId": "removeFavorite",
        "summary": "取消收藏",
        "parameters": [
          {
            "name": "trackId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "description": "曲目 ID"
          }
        ],
        "responses": {
          "200": {
            "description": "删除成功",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/OkResponse" }
              }
            }
          },
          "404": {
            "description": "收藏不存在",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MessageResponse" }
              }
            }
          }
        }
      }
    },

    "/api/suno/history": {
      "get": {
        "tags": ["history"],
        "operationId": "getHistory",
        "summary": "获取所有音乐历史",
        "responses": {
          "200": {
            "description": "历史列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/HistoryResponse" }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["history"],
        "operationId": "saveHistory",
        "summary": "保存音乐历史",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/HistorySaveRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "保存的历史项",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HistoryResponse" }
              }
            }
          }
        }
      }
    },
    "/api/personas": {
      "get": {
        "tags": ["personas"],
        "operationId": "getPersonas",
        "summary": "获取所有 Persona",
        "responses": {
          "200": {
            "description": "Persona 列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/PersonaResponse" }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["personas"],
        "operationId": "savePersona",
        "summary": "保存 Persona",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/PersonaSaveRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "保存的 Persona",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/PersonaResponse" }
              }
            }
          }
        }
      }
    },
    "/api/suno/generate": {
      "post": {
        "tags": ["suno"],
        "operationId": "generateMusic",
        "summary": "生成音乐（服务端代理 Suno API）",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/GenerateRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "任务结果",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/TaskResult" }
              }
            }
          }
        }
      }
    },
    "/api/suno/tasks": {
      "get": {
        "tags": ["suno"],
        "operationId": "getTasks",
        "summary": "获取所有音乐生成任务",
        "responses": {
          "200": {
            "description": "任务列表",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/TaskListResult" }
              }
            }
          }
        }
      }
    },
    "/api/suno/tasks/{taskId}": {
      "get": {
        "tags": ["suno"],
        "operationId": "getTaskById",
        "summary": "按 taskId 查询任务详情",
        "parameters": [
          {
            "name": "taskId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "description": "任务 ID"
          }
        ],
        "responses": {
          "200": {
            "description": "任务详情",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/TaskResult" }
              }
            }
          },
          "404": {
            "description": "任务不存在",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/api/config/{key}": {
      "get": {
        "tags": ["config"],
        "operationId": "getConfig",
        "summary": "读取配置项",
        "parameters": [
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "description": "配置键名"
          }
        ],
        "responses": {
          "200": {
            "description": "配置值",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ConfigResponse" }
              }
            }
          }
        }
      }
    },
    "/api/config": {
      "put": {
        "tags": ["config"],
        "operationId": "setConfig",
        "summary": "写入或更新配置项",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ConfigEntry" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "操作成功",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/OkResponse" }
              }
            }
          }
        }
      }
    },
    "/api/music/search": {
      "get": {
        "tags": ["music"],
        "operationId": "searchMusicByQuery",
        "summary": "按关键词搜索歌曲（GET）",
        "parameters": [
          {
            "name": "query",
            "in": "query",
            "required": true,
            "schema": { "type": "string" },
            "description": "搜索关键词"
          }
        ],
        "responses": {
          "200": {
            "description": "搜索结果",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MusicSearchResult" }
              }
            }
          },
          "400": {
            "description": "缺少 query 参数",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["music"],
        "operationId": "searchMusic",
        "summary": "按关键词搜索歌曲（POST JSON）",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/SearchRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "搜索结果",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MusicSearchResult" }
              }
            }
          }
        }
      }
    }
  },

  "components": {
    "schemas": {
      "FavoriteRequest": {
        "type": "object",
        "required": ["trackId", "taskId"],
        "properties": {
          "trackId": { "type": "string", "description": "曲目 ID" },
          "taskId": { "type": "string", "description": "任务 ID" },
          "audioUrl": { "type": "string", "description": "音频 URL" },
          "title": { "type": "string", "description": "标题" },
          "tags": { "type": "string", "description": "标签" },
          "imageUrl": { "type": "string", "description": "封面图 URL" },
          "duration": { "type": "number", "format": "double", "description": "时长（秒）" }
        }
      },
      "FavoriteResponse": {
        "type": "object",
        "required": ["id", "trackId", "taskId"],
        "properties": {
          "id": { "type": "integer", "format": "int64", "description": "数据库主键" },
          "trackId": { "type": "string", "description": "曲目 ID" },
          "taskId": { "type": "string", "description": "任务 ID" },
          "audioUrl": { "type": "string", "description": "音频 URL" },
          "title": { "type": "string", "description": "标题" },
          "tags": { "type": "string", "description": "标签" },
          "imageUrl": { "type": "string", "description": "封面图 URL" },
          "duration": { "type": "number", "format": "double", "description": "时长（秒）" },
          "createdAt": { "type": "string", "description": "创建时间" }
        }
      },
      "HistorySaveRequest": {
        "type": "object",
        "required": ["taskId", "status"],
        "properties": {
          "taskId": { "type": "string", "description": "任务 ID" },
          "type": { "type": "string", "default": "generate", "description": "类型（generate 等）" },
          "status": { "type": "string", "description": "状态" },
          "tracks": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/HistoryTrackDto" },
            "description": "关联音轨列表"
          }
        }
      },
      "HistoryTrackDto": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "description": "音轨 ID" },
          "audioUrl": { "type": "string", "description": "音频 URL" },
          "title": { "type": "string", "description": "标题" },
          "tags": { "type": "string", "description": "标签" },
          "imageUrl": { "type": "string", "description": "封面图 URL" },
          "duration": { "type": "number", "format": "double", "description": "时长（秒）" }
        }
      },
      "HistoryResponse": {
        "type": "object",
        "required": ["id", "taskId", "type", "status"],
        "properties": {
          "id": { "type": "integer", "format": "int64", "description": "数据库主键" },
          "taskId": { "type": "string", "description": "任务 ID" },
          "type": { "type": "string", "description": "类型" },
          "status": { "type": "string", "description": "状态" },
          "tracks": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/HistoryTrackDto" },
            "description": "关联音轨列表"
          },
          "createdAt": { "type": "string", "description": "创建时间" }
        }
      },
      "PersonaSaveRequest": {
        "type": "object",
        "required": ["personaId", "name", "description"],
        "properties": {
          "personaId": { "type": "string", "description": "Persona ID" },
          "name": { "type": "string", "description": "名称" },
          "description": { "type": "string", "description": "描述" }
        }
      },
      "PersonaResponse": {
        "type": "object",
        "required": ["id", "personaId", "name", "description"],
        "properties": {
          "id": { "type": "integer", "format": "int64", "description": "数据库主键" },
          "personaId": { "type": "string", "description": "Persona ID" },
          "name": { "type": "string", "description": "名称" },
          "description": { "type": "string", "description": "描述" },
          "createdAt": { "type": "string", "description": "创建时间" }
        }
      },
      "GenerateRequest": {
        "type": "object",
        "required": ["prompt"],
        "properties": {
          "prompt": { "type": "string", "description": "歌词/提示词" },
          "title": { "type": "string", "description": "标题" },
          "tags": { "type": "string", "description": "风格标签" },
          "mv": { "type": "string", "default": "chirp-v5", "description": "模型版本" },
          "make_instrumental": { "type": "boolean", "default": false, "description": "是否纯音乐" }
        }
      },
      "TaskResponse": {
        "type": "object",
        "required": ["id", "task_id", "status"],
        "properties": {
          "id": { "type": "integer", "format": "int64", "description": "数据库主键" },
          "task_id": { "type": "string", "description": "任务 ID" },
          "status": { "type": "string", "description": "任务状态（queued/complete/failed）" },
          "title": { "type": "string", "description": "标题" },
          "tags": { "type": "string", "description": "风格标签" },
          "prompt": { "type": "string", "description": "提示词" },
          "mv": { "type": "string", "description": "模型版本" },
          "audio_url": { "type": "string", "description": "音频 URL" },
          "video_url": { "type": "string", "description": "视频 URL" },
          "error_message": { "type": "string", "description": "错误信息" },
          "created_at": { "type": "string", "description": "创建时间" },
          "updated_at": { "type": "string", "description": "更新时间" }
        }
      },
      "TaskResult": {
        "type": "object",
        "properties": {
          "code": { "type": "integer", "format": "int32", "default": 200, "description": "状态码" },
          "message": { "type": "string", "default": "ok", "description": "消息" },
          "data": { "$ref": "#/components/schemas/TaskResponse" }
        }
      },
      "TaskListResult": {
        "type": "object",
        "properties": {
          "code": { "type": "integer", "format": "int32", "default": 200, "description": "状态码" },
          "message": { "type": "string", "default": "ok", "description": "消息" },
          "data": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/TaskResponse" },
            "description": "任务列表"
          }
        }
      },
      "ConfigEntry": {
        "type": "object",
        "required": ["key", "value"],
        "properties": {
          "key": { "type": "string", "description": "配置键名" },
          "value": { "type": "string", "description": "配置值" },
          "description": { "type": "string", "description": "配置描述" }
        }
      },
      "ConfigResponse": {
        "type": "object",
        "required": ["key"],
        "properties": {
          "key": { "type": "string", "description": "配置键名" },
          "value": { "type": "string", "description": "配置值" }
        }
      },
      "SearchRequest": {
        "type": "object",
        "required": ["query"],
        "properties": {
          "query": { "type": "string", "description": "搜索关键词" },
          "limit": { "type": "integer", "format": "int32", "default": 20, "description": "返回数量上限" }
        }
      },
      "MusicSearchResult": {
        "type": "object",
        "description": "音乐搜索结果（结构取决于上游搜索引擎，此处为通用 JSON 对象）",
        "additionalProperties": true
      },
      "ErrorResponse": {
        "type": "object",
        "required": ["code", "message"],
        "properties": {
          "code": { "type": "integer", "format": "int32", "description": "错误码" },
          "message": { "type": "string", "description": "错误信息" }
        }
      },
      "OkResponse": {
        "type": "object",
        "properties": {
          "ok": { "type": "boolean", "description": "操作是否成功" }
        }
      },
      "MessageResponse": {
        "type": "object",
        "properties": {
          "message": { "type": "string", "description": "消息内容" }
        }
      }
    }
  }
}